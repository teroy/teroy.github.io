<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">














<meta property="og:type" content="website">
<meta property="og:title" content="Teroy’s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Teroy’s Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Teroy’s Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"right","display":"always","offset":6,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Teroy’s Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Teroy’s Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/01/gorm-loc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teroy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teroy’s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/01/gorm-loc/" itemprop="url">GORM时区配置</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-01T00:00:00+00:00">
                2018-12-01
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/12/01/gorm-loc/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2018/12/01/gorm-loc/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>近期有同事反馈，测试环境的数据库存储的datetime与北京时间有差异，看到这个问题我的第一反应可能是时区配置有问题。首先检查了一下mysql服务器的时区配置，配置的确实是北京时间，所以就排除了mysql服务器的问题，接下来再检查了一下业务服务器的时区配置，发现配置的UTC时间，由此可以初步确定是业务服务器的问题。通常遇到这个问题最快的解决方案是将服务器的时区改为北京时间，然而仔细思考一番，假如真的有服务器时区配置不一致的问题，难道就只能通过事后发现的修复方案，没有预防方案?<br>我们使用golang作为后端语言，数据库操作层面使用了gorm框架，查阅了gorm相关技术文档，发现gorm是支持时区配置的，那么这个gorm时区配置是否真的可以作为一个预防方案？实践出真知，接下来将通过一些样例代码来验证这个问题。</p>
<h4 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h4><p>(1) 将本地环境的时区调为UTC<br>(2) 使用mysql数据库，建立一张测试表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE test(</span><br><span class="line">    d datetime NOT NULL</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<h4 id="样例代码-入库时间使用本地时区"><a href="#样例代码-入库时间使用本地时区" class="headerlink" title="样例代码:入库时间使用本地时区"></a>样例代码:入库时间使用本地时区</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">conStr := <span class="string">"root:123456@tcp(192.168.3.93:33061)/zxd?charset=utf8mb4&amp;parseTime=true&amp;loc=Local"</span></span><br><span class="line">db, err := gorm.Open(<span class="string">"mysql"</span>, conStr)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Fatalf(<span class="string">"%v"</span>, err)</span><br><span class="line">&#125;</span><br><span class="line">db.LogMode(<span class="literal">true</span>)</span><br><span class="line">db = db.Exec(<span class="string">"INSERT INTO test (d) VALUES (?)"</span>, time.Now())</span><br><span class="line"><span class="keyword">if</span> db.Error != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Fatalf(<span class="string">"%v"</span>, db.Error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>gorm配置的时区为使用本地时区，通过查询数据库表可以观察得到，生成的时间为本地当前时间。</p>
<h4 id="样例代码-使用配置时区"><a href="#样例代码-使用配置时区" class="headerlink" title="样例代码:使用配置时区"></a>样例代码:使用配置时区</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">conStr := <span class="string">"root:123456@tcp(192.168.3.93:33061)/zxd?charset=utf8mb4&amp;parseTime=true&amp;loc=Asia%2fShanghai"</span></span><br><span class="line">db, err := gorm.Open(<span class="string">"mysql"</span>, conStr)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Fatalf(<span class="string">"%v"</span>, err)</span><br><span class="line">&#125;</span><br><span class="line">db.LogMode(<span class="literal">true</span>)</span><br><span class="line">db = db.Exec(<span class="string">"INSERT INTO test (d) VALUES (?)"</span>, time.Now())</span><br><span class="line"><span class="keyword">if</span> db.Error != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Fatalf(<span class="string">"%v"</span>, db.Error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意 <code>loc=Asia%2fShanghai</code>，gorm配置链接字符串要求对Loc做UrlEncode处理，这里配置成固定的北京时间，通过查询数据库可以验证入库的时间正确性。<br>翻看gorm的源码，可以看到，拼接sql的时候，gorm使用配置的时区对time.Time类型的变量做了一次转换，代码如下：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> time.Time:</span><br><span class="line">    paramTypes[i+i] = <span class="keyword">byte</span>(fieldTypeString)</span><br><span class="line">    paramTypes[i+i+<span class="number">1</span>] = <span class="number">0x00</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> a [<span class="number">64</span>]<span class="keyword">byte</span></span><br><span class="line">    <span class="keyword">var</span> b = a[:<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> v.IsZero() &#123;</span><br><span class="line">        b = <span class="built_in">append</span>(b, <span class="string">"0000-00-00"</span>...)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        b = v.In(mc.cfg.Loc).AppendFormat(b, timeFormat)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    paramValues = appendLengthEncodedInteger(paramValues,</span><br><span class="line">        <span class="keyword">uint64</span>(<span class="built_in">len</span>(b)),</span><br><span class="line">    )</span><br><span class="line">    paramValues = <span class="built_in">append</span>(paramValues, b...)</span><br></pre></td></tr></table></figure></p>
<p>这里需要注意一个细节，就是配置的时区只对time.Time类型有效，假如我们使用了time.Now().Format()进行格式化当前时间，则会使用本地时间，因为作为一个sting占位符，gorm并不会做任何处理。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/27/go-code-review-comment/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teroy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teroy’s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/27/go-code-review-comment/" itemprop="url">golang代码实践指南</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-27T16:00:00+00:00">
                2018-07-27
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/27/go-code-review-comment/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2018/07/27/go-code-review-comment/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本篇文章是基于<a href="https://github.com/golang/go/wiki/CodeReviewComments" target="_blank" rel="noopener">链接</a>的精简翻译，作为<a href="https://golang.org/doc/effective_go.html" target="_blank" rel="noopener">Effective Go</a>的补充，主要罗列了一系列golang语言的编程实践规范，对于开发者而言具有很好的参考价值。</p>
<h4 id="Gofmt"><a href="#Gofmt" class="headerlink" title="Gofmt"></a>Gofmt</h4><p>gofmt是一款golang的代码格式化组件，推荐在保存代码前运行gofmt来自动格式化代码，这样子能让团队项目有近乎一致的代码风格，从而提高代码的可读性。</p>
<h4 id="Comment-Sentences"><a href="#Comment-Sentences" class="headerlink" title="Comment Sentences"></a>Comment Sentences</h4><p>文档注释代码必须是一条完整的语句，以句号结尾，以被描述的内容（方法名、类型名、变量名、常量名、包名）开头，例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// Request represents a request to run a command.</span><br><span class="line">type Request struct &#123; ...</span><br><span class="line"></span><br><span class="line">// Encode writes the JSON encoding of req to w.</span><br><span class="line">func Encode(w io.Writer, req *Request) &#123; ...</span><br></pre></td></tr></table></figure></p>
<h4 id="Contexts"><a href="#Contexts" class="headerlink" title="Contexts"></a>Contexts</h4><p>context.Context可以用来携带信息，通常用来传递请求周期变量。如果有需要用到它，要将其变成方法的第一个参数（推荐命名为ctx），而不是将ctx变成变量存储在一个结构体类型中。</p>
<h4 id="Declaring-Empty-Slices"><a href="#Declaring-Empty-Slices" class="headerlink" title="Declaring Empty Slices"></a>Declaring Empty Slices</h4><p>当定义一个空的切片的时候，通常有两种方式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 方式1</span><br><span class="line">var t []string</span><br><span class="line"></span><br><span class="line">// 方式2</span><br><span class="line">t := []string&#123;&#125;</span><br></pre></td></tr></table></figure></p>
<p>方式1中的t为nil，而方式2中的t则是一个非nil的零切片，在功能上两者是没有区别的（len(t)、cap(t)、append(t, “”)），但是在序列化成json的时候就有区别，方式1的t会为null，方式2的t会为[]，要特别注意这个点。</p>
<h4 id="Crypto-Rand"><a href="#Crypto-Rand" class="headerlink" title="Crypto Rand"></a>Crypto Rand</h4><p>当需要生成随机数的时候，不要使用包 <code>math/rand</code> ，因为其计算得到的是伪随机数，推荐使用包 <code>crypto/rand</code> ，示例用法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import (</span><br><span class="line">    &quot;crypto/rand&quot;</span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line">    &quot;log&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func Key() string &#123;</span><br><span class="line">    buf := make([]byte, 16)</span><br><span class="line">    _, err := rand.Read(buf)</span><br><span class="line">    if err != nil &#123;</span><br><span class="line">        log.Fatalf(err) // out of randomness, should never happen</span><br><span class="line">    &#125;</span><br><span class="line">    return fmt.Sprintf(&quot;%x&quot;, buf)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="Doc-Comments"><a href="#Doc-Comments" class="headerlink" title="Doc Comments"></a>Doc Comments</h4><p>包中所有对外可用的变量、方法、结构体、常量都应该有注释，一些重要的不对外暴露的变量、方法、结构体也要声明注释。</p>
<h4 id="Don’t-Panic"><a href="#Don’t-Panic" class="headerlink" title="Don’t Panic"></a>Don’t Panic</h4><p>不要使用panic来处理错误，应该使用error返回。</p>
<h4 id="Error-Strings"><a href="#Error-Strings" class="headerlink" title="Error Strings"></a>Error Strings</h4><p>错误描述不要使用大写字母开头（除非是专有名词或缩写），不要用任何标点符号结尾，这样在记录log的时候可以组成一条完整的语句。</p>
<h4 id="Goroutine-Lifetimes"><a href="#Goroutine-Lifetimes" class="headerlink" title="Goroutine Lifetimes"></a>Goroutine Lifetimes</h4><p>当大量启用协程的时候，应该尽量让代码保持简单，使得协程的生命周期很清晰。</p>
<h4 id="Handle-Errors"><a href="#Handle-Errors" class="headerlink" title="Handle Errors"></a>Handle Errors</h4><p>当函数返回error的时候，不要使用_吞掉error，每个error都应该被处理。</p>
<h4 id="Imports"><a href="#Imports" class="headerlink" title="Imports"></a>Imports</h4><p>当引入的包出现命名有重复时候，优先对本项目的包起别名；引入的包要分组，组之间留一空行，golang的标准包默认要放在开头位置，例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line">    &quot;hash/adler32&quot;</span><br><span class="line">    &quot;os&quot;</span><br><span class="line"></span><br><span class="line">    &quot;github.com/foo/bar&quot;</span><br><span class="line">    &quot;rsc.io/goversion/version&quot;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<h4 id="In-Band-Errors"><a href="#In-Band-Errors" class="headerlink" title="In-Band Errors"></a>In-Band Errors</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// (不推荐做法) Lookup returns the value for key or &quot;&quot; if there is no mapping for key.</span><br><span class="line">func Lookup(key string) string</span><br><span class="line"></span><br><span class="line">// (推荐做法) Lookup returns the value for key or ok=false if there is no mapping for key.</span><br><span class="line">func Lookup(key string) (value string, ok bool)</span><br></pre></td></tr></table></figure>
<h4 id="Initialisms"><a href="#Initialisms" class="headerlink" title="Initialisms"></a>Initialisms</h4><p>对于名词缩写词，命名的时候要使用全部大写或者全部小写，例如”URL”作为命名的一部分的时候，应命名为”urlPony或者URLPony”，而不是”UrlPony”。</p>
<h4 id="Named-Result-Parameters"><a href="#Named-Result-Parameters" class="headerlink" title="Named Result Parameters"></a>Named Result Parameters</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// Location returns f&apos;s latitude and longitude.</span><br><span class="line">// Negative values mean south and west, respectively.</span><br><span class="line">func (f *Foo) Location() (lat, long float64, err error)</span><br></pre></td></tr></table></figure>
<p>适当地给多返回参数命名，可以提高代码的可读性。</p>
<h4 id="Package-Comments"><a href="#Package-Comments" class="headerlink" title="Package Comments"></a>Package Comments</h4><p>包名的注释通常注释在go文件的首行，注释中间不留空行。如果对”package main”注释，通常使用编程生成的二进制文件的名称开头，例如seedgen二进制文件的注释：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">// Binary seedgen ...</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">// Command seedgen ...</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">// Program seedgen ...</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">// The seedgen command ...</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">// The seedgen program ...</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">// Seedgen ..</span><br><span class="line">package main</span><br></pre></td></tr></table></figure></p>
<h4 id="Package-Names"><a href="#Package-Names" class="headerlink" title="Package Names"></a>Package Names</h4><p>对于包内的变量命名，要尽量精简，无需要带包的名称前缀，例如包chubby：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">package chubby</span><br><span class="line"></span><br><span class="line">// (不推荐)</span><br><span class="line">var ChubbyFile *os.File</span><br><span class="line"></span><br><span class="line">// (推荐)</span><br><span class="line">var File *os.File</span><br></pre></td></tr></table></figure></p>
<p>对于包的命名则要避免使用太泛的名字，例如common、util、api、types、interfaces等。</p>
<h4 id="Pass-Values"><a href="#Pass-Values" class="headerlink" title="Pass Values"></a>Pass Values</h4><p>当函数内部无需使用到参数的指针类型，同时传入的参数不是一个大结构体的时候，尽量不要使用指针类型参数传递。</p>
<h4 id="Receiver-Names"><a href="#Receiver-Names" class="headerlink" title="Receiver Names"></a>Receiver Names</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">type UserService struct&#123;&#125;</span><br><span class="line"></span><br><span class="line">// (不推荐) 使用me、this、self作为receiver名称</span><br><span class="line">func (me *UserService) AddUser() &#123;&#125;</span><br><span class="line"></span><br><span class="line">// (推荐) 直接使用结构体的首字母简写</span><br><span class="line">func (u *UserService) AddUser() &#123;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Receiver-Types"><a href="#Receiver-Types" class="headerlink" title="Receiver Types"></a>Receiver Types</h4><p>receiver该使用值类型还是指针类型的一些指导原则：<br>(1) 当receiver是map或者func或者chan的时候，使用值类型；<br>(2) 当receiver是slice且方法内部无需reslice的时候，使用值类型；<br>(3) 当方法内部需要改动receiver的内容的时候，使用指针类型；<br>(4) 当receiver是结构体，同时结构体中包含有sync.Mutex等同步变量的时候，使用指针类型，从而避免同步变量被复制而失效的问题；<br>(5) 当receiver是大数组或者大结构体的时候，使用指针类型，可以提高性能；<br>(6) 当然，出现意见分歧的时候，那就使用指针类型。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/01/go-dep/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teroy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teroy’s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/01/go-dep/" itemprop="url">dep使用指南</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-01T16:00:00+00:00">
                2018-05-01
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/05/01/go-dep/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2018/05/01/go-dep/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="什么是dep"><a href="#什么是dep" class="headerlink" title="什么是dep"></a>什么是dep</h4><p>dep是一款golang的包管理工具，通过将工程中相关依赖的包加载到工程目录下的vendor文件夹的形式，实现包的版本管理。</p>
<h4 id="为什么要使用dep"><a href="#为什么要使用dep" class="headerlink" title="为什么要使用dep"></a>为什么要使用dep</h4><p>要解释这个问题，首先要解释为什么要出现vendor目录。在没有vendor目录之前，golang在查找工程中引入的第三方包的时候，会到环境上配置的$GOPATH目录下查找对应目录的包，意味着我们在使用一个包的时候，必须先用 <code>go get</code> 命名下载到$GOPATH中，但是我们知道第三方包会有版本的概念，假如A工程引用了P包的v1.0.0版本，B工程引用了P包的v2.0.0版本，但是每个$GOPATH下面对应的P包只能存放一份，所以每次需要编译不同的AB不同的工程的时候，需要到$GOPATH手工切换第三方包的版本，整个流程就会变得很繁琐。</p>
<p>为了解决这个问题，golang在go1.5版本引入了vendor目录的概念，golang在查找工程中引入的第三方包的时候会优先到当前工程中的vendor目录中查找包，我们只需要将需要用到的包按目录规则存放即可，这样包的版本问题就迎刃而解了。</p>
<p>而dep就是用来做vendor包管理的工具，提供了初始化vendor包和更新vendor包的命令，以及对vendor中的第三方包的约束配置，能帮助开发者更好地管理工程中的包依赖。</p>
<h4 id="如何安装dep"><a href="#如何安装dep" class="headerlink" title="如何安装dep"></a>如何安装dep</h4><p><a href="https://golang.github.io/dep/docs/installation.html" target="_blank" rel="noopener">官方文档</a> 提供了详细的安装指南，这里也提供一种我个人比较推荐的做法：<br>首先先将$GOPATH/bin目录加入到机器的$PATH中，然后使用 <code>go get</code> 命令下载dep包即可，命令执行如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -v github.com/golang/dep/cmd/dep</span><br></pre></td></tr></table></figure></p>
<h4 id="如何使用dep在工程中初始化依赖"><a href="#如何使用dep在工程中初始化依赖" class="headerlink" title="如何使用dep在工程中初始化依赖"></a>如何使用dep在工程中初始化依赖</h4><p>安装上一步安装好dep后，即可开始使用dep命令了。对于一个之前没引入vendor包的项目来说，需要执行一下的命名做初始化：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// -v表示详细打印整个初始化过程，由于很多golang相关的包都需要翻墙下载，网络会存在</span><br><span class="line">// 不稳定的情况，所以最好是带上这个指令打印详细输出信息</span><br><span class="line">dep init -v</span><br></pre></td></tr></table></figure></p>
<p>执行命令成功后，我们会看到工程目录下除了多了vendor目录外，还会生成两个文件：Gopkg.toml和Gopkg.lock，Gopkg.toml文件是用来做包的约束说明（例如指定某个依赖包的版本），Gopkg.lock文件则是描述了当前vendor目录下所有包的版本信息。</p>
<h4 id="关于Gopkg-toml的配置说明"><a href="#关于Gopkg-toml的配置说明" class="headerlink" title="关于Gopkg.toml的配置说明"></a>关于Gopkg.toml的配置说明</h4><p>Gopkg.toml提供了丰富的包约束规则配置，具体介绍如下：<br>(1) require/ignored 配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 示例</span><br><span class="line">require = [&quot;github.com/garyburd/redigo&quot;, &quot;github.com/bradfitz/gomemcache&quot;]</span><br><span class="line">ignored = [&quot;github.com/go-ini/ini&quot;]</span><br></pre></td></tr></table></figure></p>
<p>当包路径出现在require节点中，则表示不管当前工程中有没有用到这个包都将这个包加入到vendor中，这个特性在有些场景下很会用，比如做一些开发脚手架的时候，某些包在外来有极大可能会被引用，则先把它们加入到require节点中，避免未来用到的时候再执行一次包引入；</p>
<p>出现在ignored中的包路径，则表示不管当前工程有没有用到这个包都将不把这个包加入到vendor中，这个特性的用途主要在当出现间接引用的时候，比如A-&gt;B-&gt;C，如果确定C在当前的工程中没被执行到，则可以考虑将C不加入到vendor包，减少编译生成的文件大小（不过这个做法其实并不常见，建议谨慎使用）。</p>
<p>(2) prune 配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 示例</span><br><span class="line">[prune]</span><br><span class="line">  go-tests = true</span><br><span class="line">  unused-packages = true</span><br></pre></td></tr></table></figure></p>
<p>prune的中文意思是精简的意思，默认生成的Gopkg.toml文件通常会带上示例的配置，<code>go-tests = true</code> 表示vendor目录将不包含包中_test结尾的go文件，<code>unused-packages = true</code> 表示没有被用到的包将不包含在vendor目录中（例如有外部包结构如下：github.com/teroy/stark/a和github.com/teroy/stark/b，假如工程中只引入了a包，则b包不会出现在vendor目录中）。</p>
<p>注意如果要改变精简条件，无需将false赋值给对应项的配置，而是直接将对应项的配置在配置文件中移除。</p>
<p>(3) constraint 配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 示例</span><br><span class="line">[[constraint]]</span><br><span class="line">  name = &quot;github.com/teroy/common&quot;</span><br><span class="line">  branch = &quot;master&quot;</span><br><span class="line">  source = &quot;git@github.com:teroy/common.git&quot;</span><br></pre></td></tr></table></figure></p>
<p>constraint用来配置当前工程的直接依赖包约束。constraint提供了较多的配置项，具体罗列如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[[constraint]]</span><br><span class="line">  // 包名（节必须配置）</span><br><span class="line">  name = &quot;github.com/teroy/common&quot;</span><br><span class="line">  // branch、version和revision 只允许配置一个（必须配置）</span><br><span class="line">  branch = &quot;master&quot; // 表示当前包的获取分支</span><br><span class="line">  version = &quot;1.0.0&quot; // 表示获取包的版本，&quot;1.0.0&quot;表示获取范围为&gt;=&quot;1.0.0&quot;, &lt;&quot;2.0.0&quot;，参考:(https://golang.github.io/dep/docs/Gopkg.toml.html#version)</span><br><span class="line">  revision = &quot;12766cc1f36d22b11887b42740d06ff966534e0a&quot; // 表示指定具体的git的commit SHA1 通常情况下不使用，只有在确定version没有适合的版本的情况下使用</span><br><span class="line">  // 源地址（可选配置）</span><br><span class="line">  source = &quot;git@github.com:teroy/common.git&quot; // 默认使用http的形式，也可以配置ssh的形式</span><br></pre></td></tr></table></figure></p>
<p>(4) ovverride 配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 示例</span><br><span class="line">[[override]]</span><br><span class="line">  name = &quot;github.com/teroy/common&quot;</span><br><span class="line">  branch = &quot;master&quot;</span><br><span class="line">  source = &quot;git@github.com:teroy/common.git&quot;</span><br></pre></td></tr></table></figure></p>
<p>override与constraint相同的配置约束，唯一不同的是override使用来配置当前工程的间接依赖包约束。</p>
<h4 id="dep-ensure-命令说明"><a href="#dep-ensure-命令说明" class="headerlink" title="dep ensure 命令说明"></a>dep ensure 命令说明</h4><p><code>dep ensure -v</code> 执行的过程中，会做以下两个检查：检查当前工程所需要的包是否和.lock文件中指定的包一致以及检查.toml文件中的约束条件是否和.lock文件中指定的包一致。假如出现了不一致的情况，则dep会执行工程的所有依赖包的重新加载，所以这个命令适合于工程中引入了新的包（不存在于.lock文件中配置的包）的时候执行，或者修改了.toml配置的时候执行。注意只要.lock文件指定的包的版本是在.toml约束范围内，不管.toml文件如何变动，执行这条命令都不会更新包到约束范围内的最新版本。</p>
<p>那如果我们要更新某个包到约束范围内的最新版本要怎么做呢？答案就是执行 <code>dep ensure -v -update 具体的包</code>，当然也可以直接执行 <code>dep ensure -v -update</code> 更新所有的包，但通常这会比较费时，一般也不推荐这种方式。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/02/php-ZipArchive-extension-issue/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teroy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teroy’s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/02/php-ZipArchive-extension-issue/" itemprop="url">ZipArchive扩展遇到的问题</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-02T16:00:00+00:00">
                2017-05-02
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/05/02/php-ZipArchive-extension-issue/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2017/05/02/php-ZipArchive-extension-issue/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>近期已经遇到了两个关于php扩展zip压缩的问题，而且问题都属于比较难以排查的，因为都跟环境有关系，所以这里总结记录一下。</p>
<h4 id="问题1：php版本问题"><a href="#问题1：php版本问题" class="headerlink" title="问题1：php版本问题"></a>问题1：php版本问题</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$zip = <span class="keyword">new</span> \ZipArchive;</span><br><span class="line">$res = $zip-&gt;open($destination, \ZIPARCHIVE::OVERWRITE);</span><br><span class="line"><span class="keyword">if</span> ($res == <span class="keyword">true</span>) &#123;</span><br><span class="line">    <span class="comment">// todo</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在php5.5下，以上代码是可以正常运行，当$destination这个文件路径不存在的时候会创建，如果存在则重新生成并覆盖。我们线上的部署环境是用php5.5，我本机使用php5.6，然而这段代码在php5.6下运行就会报错，当$destination不存在时候它无法生成新文件！<br>stackoverflow一番之后，顺利找到问题的<a href="https://bugs.php.net/bug.php?id=71064" target="_blank" rel="noopener">根源</a>，php5.6已经不再支持这个特性，为了解决这个问题必须使用下面的代码：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$zip = <span class="keyword">new</span> \ZipArchive;</span><br><span class="line"><span class="comment">// 同时指定\ZIPARCHIVE::CREATE 解决php5.6的不兼容问题</span></span><br><span class="line">$res = $zip-&gt;open($destination, \ZIPARCHIVE::CREATE | \ZIPARCHIVE::OVERWRITE);</span><br><span class="line"><span class="keyword">if</span> ($res == <span class="keyword">true</span>) &#123;</span><br><span class="line">    <span class="comment">// todo</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="问题2：zip扩展版本问题"><a href="#问题2：zip扩展版本问题" class="headerlink" title="问题2：zip扩展版本问题"></a>问题2：zip扩展版本问题</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$zip = <span class="keyword">new</span> \ZipArchive;</span><br><span class="line">$res = $zip-&gt;open($destination, \ZIPARCHIVE::CREATE | \ZIPARCHIVE::OVERWRITE);</span><br><span class="line"><span class="keyword">if</span> ($res === <span class="keyword">true</span>) &#123;</span><br><span class="line">    $fileName = iconv(<span class="string">"UTF-8"</span>, <span class="string">"GBK//IGNORE"</span>, $fileName);</span><br><span class="line">    $zip-&gt;addFile($exportFilePath, $fileName);</span><br><span class="line">    $zip-&gt;close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里可以看到fileName变量做了一次编码转换，因为当文件名称为中文的时候，压缩包解压出来的文件名会变为乱码，所以这里做了一次特殊转码。<br>然而，同样的代码到了另外一台服务器上运行，会发现压缩包下载下来双击打开里面的文件会被隐藏了！一步一步调试代码后，发现只要移除那一句对fileName变量的编码转换，压缩就会变得正常了，中文也不会出现乱码，但是有些环境不转码又会出现乱码，这让人非常怀疑是扩展版本问题。执行php –ri zip命令查看扩展的版本，确实也发现了两个环境的扩展版本不一样，乱码的环境zip版本是1.11.0，而另一个环境是1.13.0，这样就基本定位到问题了，1.11.0版本的zip扩展对中文的文件名称支持地不好，在1.13.0版本就修复了这个问题，然而如果代码中对文件名称做了特殊转码，在1.13.0版本又会引发新的问题，压缩包打开不显示文件。<br>最终的解决方案是升级所有环境的zip扩展到1.13.0版本，然后移除掉对file转码的代码。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/05/linux-dir/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teroy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teroy’s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/05/linux-dir/" itemprop="url">linux目录文件介绍</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-05T16:00:00+00:00">
                2017-04-05
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/04/05/linux-dir/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2017/04/05/linux-dir/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <table><tr><td width="70px">目录</td><td>说明</td></tr><tr><td>/home</td><td>用户主文件夹，当创建一个普通用户的时候，一般都会生成一个同名的文件夹在home目录下。</td></tr><tr></tr><tr><td>/root</td><td>root用户的主文件夹。</td></tr><tr></tr><tr><td>/etc</td><td>配置文件目录。注意：/etc/init.d为service服务的脚本存放路径。</td></tr><tr></tr><tr><td>/bin</td><td>系统的可执行文件存放目录，该文件下的命令可被所有用户使用，这个目录一般我们是不需要去动它。</td></tr><tr></tr><tr><td>/sbin</td><td>这个目录下的命令root用户可以用来设置系统环境，一般我们也不需要去动它。</td></tr><tr></tr><tr><td>/usr</td><td>usr并非user的简写，而是Unix Software Resource，所有系统默认的软件都会放置到/usr下，有些类似于windows系统的C:\Windows\和C:\Program files\的结合体。</td></tr><tr></tr><tr><td>/opt</td><td>第三方软件包安装目录。我们用yum安装的包可能会安装到该目录下，注意与/usr/local目录区分，/usr/local通常是用来作为下载源码编译安装的目录。</td></tr><tr></tr><tr><td>/proc</td><td>这个目录属于虚拟文件系统，它的所有数据都是放在内存中，本身不占用任何硬盘资源，用来存储进程相关的信息。eg：/proc/进程id/status 查看某个进程的相关信息</td></tr><tr></tr><tr><td>/tmp</td><td>临时文件夹，所有的用户都有rwx权限，linux会定期自动清理tmp下面的文件，所以这个目录一般用来存放一些不重要的临时文件。</td></tr><tr></tr><tr><td>/var</td><td>主要存储变动频繁数据的目录。eg：/var/cache 应用程序的缓存目录；/var/log 日记目录；/var/run 应用程序的pid存放目录</td></tr><tr></tr></table>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/11/composer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teroy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teroy’s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/11/composer/" itemprop="url">composer使用实践</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-11T16:00:00+00:00">
                2017-03-11
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/03/11/composer/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2017/03/11/composer/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>composer作为php领域最为流行的包依赖管理器，基本也成为每个phper的必备技能之一，composer官方也提供了很好的<a href="http://docs.phpcomposer.com/00-intro.html" target="_blank" rel="noopener">中文学习资料</a>，整体而言也是很容易上手的。自己在使用composer的过程中也遇到了概念不清晰和实践方面的问题，所以用这篇文章来记录总结一下。</p>
<h4 id="问题1：该不该将vendor文件夹包裹在源代码管理器-git、svn等-中？"><a href="#问题1：该不该将vendor文件夹包裹在源代码管理器-git、svn等-中？" class="headerlink" title="问题1：该不该将vendor文件夹包裹在源代码管理器(git、svn等)中？"></a>问题1：该不该将vendor文件夹包裹在源代码管理器(git、svn等)中？</h4><p>vendor文件夹通常都会比较大，不将其放在源代码管理器中，可以减少仓库的体积和历史提交差异记录，加快代码签入签出的速度，所以一般不将vendor包放在仓库中。但是需要注意一些问题，因为有时候composer安装的过程中需要执行一些检验token的操作，在持续集成的工具中要预留一些解决方案。</p>
<h4 id="问题2：composer提供了install和update命令来维护vendor包，那么这两个命令有什么区别呢？"><a href="#问题2：composer提供了install和update命令来维护vendor包，那么这两个命令有什么区别呢？" class="headerlink" title="问题2：composer提供了install和update命令来维护vendor包，那么这两个命令有什么区别呢？"></a>问题2：composer提供了install和update命令来维护vendor包，那么这两个命令有什么区别呢？</h4><p>与composer明确相关的有三个东西：composer.json文件、composer.lock文件和vendor文件夹。后两者都由composer自行管理，所以与开发者密切相关的就是composer.json文件。<br>要回答这个问题，前提就是要区分应用场景。假如一个项目之前完全没用过composer，现在刚刚创建好了composer.json文件，那么用install和update命令都可以完成同样的工作：生成包源文件集合vendor和composer.lock锁文件。两个命名之间没有本质区别。<br>假如项目已经使用了composer，现在修改了composer.json文件，想修改包的版本或者增加第三方包的引入，那么必须使用update命令，因为install命令会根据composer.lock来生成包源文件，它是不会去识别composer.json的改动的。<br>上述的场景中，用update命令就可以满足了，那么install命令应该在什么场景下使用呢？答案就是在生产环境中。我们可以在开发环境中维护好composer.lock文件，并将.lock文件提交到代码仓库中，到了生产环境就只用install命令，根据.lock文件生成vendor包，就不会造成生产环境贸然更新了某个包与开发环境不一致的问题。</p>
<h4 id="问题3：composer的包版本号提供了多种约定方式，那么在项目中最好用哪种方式呢？"><a href="#问题3：composer的包版本号提供了多种约定方式，那么在项目中最好用哪种方式呢？" class="headerlink" title="问题3：composer的包版本号提供了多种约定方式，那么在项目中最好用哪种方式呢？"></a>问题3：composer的包版本号提供了多种约定方式，那么在项目中最好用哪种方式呢？</h4><p>composer官网明确介绍了包的约定方式：</p>
<ul>
<li>确切的版本号: 1.0.2</li>
<li>范围: &gt;=1.0 大于1.0的版本</li>
<li>通配符: 1.0.* 1.0下的子版本</li>
<li>赋值运算符: ~1.2 相当于范围&gt;=1.2,&lt;2.0 </li>
</ul>
<p>我们最常用的使用场景应该是在require下面包裹一个第三方组件进来，这时候我认为最好的方式是使用明确版本号的方式。但是为什么呢？理由很简单：保持第三方包的稳定。第三方包基本都会作版本更新，使用其他的约定方式则会存在一个问题：当前匹配的版本会变更。举个例子，假如我们用通配符的方式引入了monolog包（require {“monolog/monolog”:”*”}），现在项目中用的是1.0版本，隔了一阵子，monolog发布了2.0版本，而且与1.0版本的api有了明显的不兼容，我们在项目中执行了composer update命令，则会自动将版本更新为2.0版本，组件api改变了，原来的地方有可能就会出现报错。<br>至于如何知道第三方包的版本，我们可以直接在<a href="https://packagist.org" target="_blank" rel="noopener">packagist</a>搜索得到，可以自行选择引入的版本。</p>
<h4 id="问题4：composer执行安装命令后一直停留在等待界面？"><a href="#问题4：composer执行安装命令后一直停留在等待界面？" class="headerlink" title="问题4：composer执行安装命令后一直停留在等待界面？"></a>问题4：composer执行安装命令后一直停留在等待界面？</h4><p>这里有些小技巧可以改进这个问题。首先就是命令的后面加上-vvv，就可以打印出具体的debug信息，实时地知道现在的运行情况；很多时候等待过久是因为遇到不翻墙下不了包的问题，这时可以通过设置包的源为中国镜像，具体可以参考<a href="https://pkg.phpcomposer.com/" target="_blank" rel="noopener">这里</a>。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/25/yii-foreach-issue/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teroy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teroy’s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/25/yii-foreach-issue/" itemprop="url">yii框架遇到的数组引用循环问题</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-25T16:00:00+00:00">
                2017-02-25
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/25/yii-foreach-issue/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2017/02/25/yii-foreach-issue/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>目前所在的公司用的yii版本是2.0.3，最近上线了一个新功能后，有个地方突然出现了问题，出错的地方的代码简化如下：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$userIds = [<span class="string">'1'</span>, <span class="string">'2'</span>];</span><br><span class="line"><span class="keyword">foreach</span> ($userIds <span class="keyword">as</span> &amp;$userId) &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">$count = \common\entities\User::find()-&gt;where([<span class="string">'user_id'</span> =&gt; $userIds])-&gt;count();</span><br><span class="line"><span class="comment">// var_dump($userIds);</span></span><br></pre></td></tr></table></figure></p>
<p>这里是用了yii的orm查询了数据，但是最后发现$userIds数组的最后一个元素被串改了，导致接下来的逻辑就出现了错误。在我把foreach循环中的引用&amp;去掉后，$userIds就没有被修改覆盖了，所以基本可以断定yii框架中应该是有地方改动了$userIds，同时也跟foreach循环使用&amp;有关。调试进去yii的框架代码中，追踪到这个方法会引起变量的改动：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">buildInCondition</span><span class="params">($operator, $operands, &amp;$params)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>($operands[<span class="number">0</span>], $operands[<span class="number">1</span>])) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="keyword">Exception</span>(<span class="string">"Operator '$operator' requires two operands."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">list</span>($column, $values) = $operands;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($values === [] || $column === []) &#123;</span><br><span class="line">        <span class="keyword">return</span> $operator === <span class="string">'IN'</span> ? <span class="string">'0=1'</span> : <span class="string">''</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($values <span class="keyword">instanceof</span> Query) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;buildSubqueryInCondition($operator, $column, $values, $params);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $values = (<span class="keyword">array</span>) $values;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (count($column) &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;buildCompositeInCondition($operator, $column, $values, $params);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (is_array($column)) &#123;</span><br><span class="line">        $column = reset($column);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">foreach</span> ($values <span class="keyword">as</span> $i =&gt; $value) &#123;</span><br><span class="line">        <span class="keyword">if</span> (is_array($value)) &#123;</span><br><span class="line">            $value = <span class="keyword">isset</span>($value[$column]) ? $value[$column] : <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ($value === <span class="keyword">null</span>) &#123;</span><br><span class="line">            $values[$i] = <span class="string">'NULL'</span>;</span><br><span class="line">        &#125; <span class="keyword">elseif</span> ($value <span class="keyword">instanceof</span> Expression) &#123;</span><br><span class="line">            $values[$i] = $value-&gt;expression;</span><br><span class="line">            <span class="keyword">foreach</span> ($value-&gt;params <span class="keyword">as</span> $n =&gt; $v) &#123;</span><br><span class="line">                $params[$n] = $v;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $phName = <span class="keyword">self</span>::PARAM_PREFIX . count($params);</span><br><span class="line">            $params[$phName] = $value;</span><br><span class="line">            $values[$i] = $phName;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (strpos($column, <span class="string">'('</span>) === <span class="keyword">false</span>) &#123;</span><br><span class="line">        $column = <span class="keyword">$this</span>-&gt;db-&gt;quoteColumnName($column);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (count($values) &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"$column $operator ("</span> . implode(<span class="string">', '</span>, $values) . <span class="string">')'</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $operator = $operator === <span class="string">'IN'</span> ? <span class="string">'='</span> : <span class="string">'&lt;&gt;'</span>;</span><br><span class="line">        <span class="keyword">return</span> $column . $operator . reset($values);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>为了进一步验证问题，写了一段简化代码去模拟，最终顺利找到了问题所在：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span><span class="params">($data)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">foreach</span> ($data <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">        $data[$k] = $k;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$data = [<span class="string">'1'</span>, <span class="string">'2'</span>];</span><br><span class="line"><span class="keyword">foreach</span> ($data <span class="keyword">as</span> &amp;$item) &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">test($data);</span><br><span class="line">var_dump($data); <span class="comment">// 输出：['1', 1]</span></span><br></pre></td></tr></table></figure></p>
<p>查阅了<a href="http://php.net/manual/zh/control-structures.foreach.php" target="_blank" rel="noopener">官方文档</a>中对foreach的使用描述，里面有谈到一个使用警告：数组最后一个元素的 $value 引用在 foreach 循环之后仍会保留，建议使用 unset() 来将其销毁。所以在使用foreach引用&amp;变量的时候，最好能在循环后unset变量，避免不必要的问题。<br>yii框架开发组应该也意识到了这个问题，经过测试，在2.0.10版中这个问题已经被修复了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/06/php-env/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teroy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teroy’s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/06/php-env/" itemprop="url">php项目根据环境读取配置的方案</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-01-06T16:00:00+00:00">
                2017-01-06
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/01/06/php-env/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2017/01/06/php-env/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>通常我们会将不同环境的配置使用不同名称的文件区分开来，比如开发环境使用dev.config，线上环境使用prod.conf，来尽可能地减少混淆出错的可能性，但是我们的代码是同一套，这样就会带来一个问题：如何根据当前的部署环境读取合适的配置？针对这个问题，根据一些实战经验，这里谈一下自己总结的三种方案。</p>
<h4 id="方案一：将环境配置文件从版本控制系统中忽略"><a href="#方案一：将环境配置文件从版本控制系统中忽略" class="headerlink" title="方案一：将环境配置文件从版本控制系统中忽略"></a>方案一：将环境配置文件从版本控制系统中忽略</h4><p>我们可以在项目中定义一个文件env.php，并在env.php定义具体的环境变量，同时将这个env.php排除在版本控制器之外（使用git的话就使用gitignore配置排除），最后在项目的入口文件中引入这个env.php，这样每个环境就可以自行在env.php中配置。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// env.php文件</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">defined(<span class="string">'PHP_ENV'</span>) <span class="keyword">or</span> define(<span class="string">'PHP_ENV'</span>, <span class="string">'dev'</span>);</span><br></pre></td></tr></table></figure></p>
<p>这个方案很灵活，但带来的一个问题是要管理的env.php可能会很多，因为一台机器上可能同时部署了好几个项目，每个项目都有一个env.php文件需要维护。</p>
<h4 id="方案二：在web服务器中配置环境变量"><a href="#方案二：在web服务器中配置环境变量" class="headerlink" title="方案二：在web服务器中配置环境变量"></a>方案二：在web服务器中配置环境变量</h4><p>php可以使用getenv()函数拿到环境变量，使用apache或者nginx可以在配置文件中定义这个环境变量，来看一个nginx配置环境变量的例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastcgi_param  PHP_ENV dev;</span><br></pre></td></tr></table></figure></p>
<p>这个方案不需要在代码中定义环境变量，但还是存在维护多个配置的问题，同时如果是运行控制台的php命令，不通过web服务器，则拿不到对应的环境变量。</p>
<h4 id="方案三：定义linux服务器的环境变量"><a href="#方案三：定义linux服务器的环境变量" class="headerlink" title="方案三：定义linux服务器的环境变量"></a>方案三：定义linux服务器的环境变量</h4><p>getenv()函数可以拿到linux配置的环境变量，通常可以在linux的启动文件/etc/profile中加入如下的命令配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PHP_ENV=&apos;dev&apos;</span><br></pre></td></tr></table></figure></p>
<p>运行web项目，还需要在配置中加入环境变量的读取，这里以nginx+php-fpm为例，需要在php-fpm.conf增加如下的配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">env[PHP_ENV] = $PHP_ENV //读取linux系统的环境变量</span><br></pre></td></tr></table></figure></p>
<p>最后将. /etc/profile加入到php的启动脚本中去，就大功告成了。<br>这个方案应该是上述方案中可维护性最高的，因为配置的地方最少，但是这个方案也存在一个问题：不够灵活，假如我们的服务器资源吃紧，需要在同一台机器上面既部署开发环境的东西，也部署测试环境的东西，这个方案就不能采用。</p>
<h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><p>当然，上述三种方案并非是单选题，也可以组合起来用，例如方案二和方案三，当我们在web服务器和linux机器定义了相同的环境变量，则在web项目中会以web服务器的为基准，这样子组合起来使用，将可以应对更多的使用场景。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/17/php7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teroy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teroy’s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/17/php7/" itemprop="url">php7杂谈</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-17T16:00:00+00:00">
                2016-12-17
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/12/17/php7/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2016/12/17/php7/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>虽然php7在2015年未的时候已经正式发布了，但自己目前所经历过的两家公司都是用着5.x版本，不过，php7注定是未来的主流，最近自己也是开始关注这块，所以写下这篇博客来记录一些自己的理解和思考。</p>
<h3 id="升级到php7"><a href="#升级到php7" class="headerlink" title="升级到php7"></a>升级到php7</h3><p>php7虽然做了大量的改动过，但同时也做了很多向下兼容的工作，所以升级到php7是没有太大问题的，当然其中也包括一些不兼容的点，具体可以参考这篇<a href="http://www.php7.site/book/php7/about-30.html" target="_blank" rel="noopener">文章</a>。我总体看了一遍，有些不兼容的改动基本是很“冷门”的，可能这个关于foreach的修改要特别注意一下：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// foreach的修改</span></span><br><span class="line">$arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">foreach</span>($arr <span class="keyword">as</span> &amp;$i) &#123;</span><br><span class="line">    var_dump(current($i)); <span class="comment">// php7输出1 1 1 php7之前输出2 3 false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>php7的foreach遍历将不再改变数组的内部指针，所以如果以前的代码有在foreach中使用current得到遍历的下一个元素的，在升级之前需要重构掉代码。</p>
<h3 id="php7新特性"><a href="#php7新特性" class="headerlink" title="php7新特性"></a>php7新特性</h3><p>关于php7新特性的介绍，可以参考官网的<a href="http://php.net/manual/zh/migration70.new-features.php" target="_blank" rel="noopener">说明文档</a>。总体而言，这次php7的升级重点并不是在语言特性上，所以语法糖并不多，相对而言也没有太多亮点的地方。</p>
<h4 id="标量类型声明和返回类型声明"><a href="#标量类型声明和返回类型声明" class="headerlink" title="标量类型声明和返回类型声明"></a>标量类型声明和返回类型声明</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新增参数类型支持int、float、string和bool</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">(int $i)</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 返回类型支持</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">()</span>: <span class="title">array</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>php是弱类型语言，弱类型语言向来被人诟病的其中一点是缺少“解析前检查”。函数的传参没有类型约束，意味着传入什么东西都可以被接受，直到了运行期问题才会被抛出，这很让人无能为力。<br>php7无疑强化了关于类型的输入和输出，语言也渐渐地严谨化和与强类型挂钩，这样带来的好处就是可以让问题暴露在解析前，让开发者能更早地知道代码的错误之处。我个人认为严谨化和强类型是未来语言发展的重要方向，宽松化和容错性高注定是要立下墓碑，所以php7的这个特性还是很切合时代的发展的。</p>
<h4 id="null合并运算符"><a href="#null合并运算符" class="headerlink" title="null合并运算符"></a>null合并运算符</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// php7之前的写法</span></span><br><span class="line">$a = <span class="keyword">isset</span>($_POST[<span class="string">'a'</span>]) ? $_POST[<span class="string">'a'</span>] : <span class="number">0</span>;</span><br><span class="line"><span class="comment">// php7的写法</span></span><br><span class="line">$a = $_POST[<span class="string">'a'</span>] ?? <span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<p>这个语法糖应该是php7所有新语法中最实用的。之前的代码确实存在太多isset加三目表达式的写法，新语法要节省多少敲击键盘的次数啊，“人生苦短，敲少代码”把。</p>
<h4 id="组合运算符-lt-gt"><a href="#组合运算符-lt-gt" class="headerlink" title="组合运算符&lt;=&gt;"></a>组合运算符&lt;=&gt;</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="number">1</span> &lt;=&gt; <span class="number">1</span>; <span class="comment">// 0</span></span><br><span class="line"><span class="keyword">echo</span> <span class="number">1</span> &lt;=&gt; <span class="number">2</span>; <span class="comment">// -1</span></span><br><span class="line"><span class="keyword">echo</span> <span class="number">2</span> &lt;=&gt; <span class="number">1</span>; <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<p>这次推出了新的运算符&lt;=&gt;，现在我能想到的一个应用场景就是在数组排序中使用：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// php7之前的写法</span></span><br><span class="line">usort($arr, <span class="function"><span class="keyword">function</span> <span class="params">($x, $y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $x - $y;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// php7的写法</span></span><br><span class="line">usort($arr, <span class="function"><span class="keyword">function</span> <span class="params">($x, $y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $x &lt;=&gt; $y;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>php7之前的写法基本也能满足，新特性并没有带来很好的体验提升，个人认为这个特性或许没有那么“必须”。</p>
<h4 id="匿名类"><a href="#匿名类" class="headerlink" title="匿名类"></a>匿名类</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">log</span><span class="params">(string $msg)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $logger;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getLogger</span><span class="params">()</span>: <span class="title">Logger</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;logger;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setLogger</span><span class="params">(Logger $logger)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">$this</span>-&gt;logger = $logger;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$app = <span class="keyword">new</span> Application;</span><br><span class="line">$app-&gt;setLogger(<span class="keyword">new</span> <span class="class"><span class="keyword">class</span> <span class="keyword">implements</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">log</span><span class="params">(string $msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> $msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>通过new class来实例化一个匿名类，适用于替代一些“用后即焚”的完整类定义。当我看到这个的时候，第一反映是这个特性与单元测试的结合。我们知道单元测试强调快速运行，假如方法中存在调用服务类的地方，需要将服务类接口化并mock一个空实现，传统的实现就要定义一个空实现的类，而有了匿名类，就可以节省这个类，同时还可以支持不同的个性化需求。</p>
<h4 id="通过define定义常量为数组类型"><a href="#通过define定义常量为数组类型" class="headerlink" title="通过define定义常量为数组类型"></a>通过define定义常量为数组类型</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// php7的实现</span></span><br><span class="line">define(<span class="string">'ORDER'</span>, [<span class="string">'unpay'</span> =&gt; <span class="number">1</span>, <span class="string">'pay'</span> =&gt; <span class="number">2</span>]);</span><br><span class="line"><span class="keyword">echo</span> ORDER[<span class="string">'unpay'</span>];</span><br><span class="line"><span class="comment">// php7之前的替代实现</span></span><br><span class="line">define(<span class="string">'ORDER_UNPAY'</span>, <span class="number">1</span>);</span><br><span class="line">define(<span class="string">'ORDER_PAY'</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p>php7之前的常量定义只能未int、float、string和bool值，现在就多了一个数组，可以将关联的元素集中化，以前的替代实现就需要数组的每个元素都定义为一个常量，现在就会方便一些。</p>
<h4 id="使用use导入一组类"><a href="#使用use导入一组类" class="headerlink" title="使用use导入一组类"></a>使用use导入一组类</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// php7之前的写法</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">common</span>\<span class="title">helper</span>\<span class="title">A</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">common</span>\<span class="title">helper</span>\<span class="title">B</span> <span class="title">as</span> <span class="title">Be</span>;</span><br><span class="line"><span class="comment">// php7的写法</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">common</span>\<span class="title">helper</span>\&#123;<span class="title">A</span>, <span class="title">B</span> <span class="title">as</span> <span class="title">Be</span>&#125;;</span><br></pre></td></tr></table></figure>
<p>这个语法糖简化了导入同一个命名空间下类的写法，但我认为还是比较麻烦，需要指定具体的类，而不是像java那样直接导入命名空间，在代码中用到的类自动识别到命名空间中，不知未来php是否会往这个方向上靠。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/15/php-error-reporting/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teroy">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teroy’s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/15/php-error-reporting/" itemprop="url">php关于error_reporting的配置</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-15T16:00:00+00:00">
                2016-12-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/12/15/php-error-reporting/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2016/12/15/php-error-reporting/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天将代码上线到测试环境的，突然报错了，但在我本地自测的时候一直是没问题的，真让人感到奇怪，这段出错的代码大概写了如下的逻辑:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseTest</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"test"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> <span class="keyword">extends</span> <span class="title">BaseTest</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getName</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">parent</span>::test();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在测试环境上调用BaseTest::getName()方法的时候，就会报一个Strict standards的错误。这里应该是自己的一个疏忽，在static方法中是不应该用parent的，但是居然在开发环境不报错！Strict standards应该是指严格标准的错误报告，第一反应就是去看本地php.ini的配置，发现自己本地的php.ini配置的error_reporting是E_ALL &amp; ~E_DEPRECATED &amp; ~E_STRICT，原来是这里将严格标准的错误报告给过滤了，结果出现了测试环境的错误。在看一下php.ini的描述，里面提到开发环境应该将error_reporting配置为E_ALL级别，而生产环境配置为E_ALL &amp; ~E_DEPRECATED &amp; ~E_STRICT，自己的开发环境装上php后就默认是去严格标准格式的，这个地方在配置开发环境的时候以后要必须注意了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="Teroy" />
            
              <p class="site-author-name" itemprop="name">Teroy</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">15</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/teroy" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:sher-lock@qq.com" target="_blank" title="邮箱">
                      
                        <i class="fa fa-fw fa-envelope"></i>邮箱</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Teroy</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: true,
        appId: 'F0GpH8LSNcKesMWFoqMhWGEG-gzGzoHsz',
        appKey: 'vfXXrc5hslHRDzfgmyGoB8bC',
        placeholder: 'Leave your comment here~~',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  

  

  
  

  

  

  

</body>
</html>
